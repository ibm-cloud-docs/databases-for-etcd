---
copyright:
  years: 2019, 2023
lastupdated: "2023-07-19"

keywords: etcd, etcd manage users

subcollection: databases-for-etcd

---

{{site.data.keyword.attribute-definition-list}}

# Managing Users and Roles
{: #user-management}

{{site.data.keyword.databases-for-etcd_full}} deployments come with authentication enabled and use etcd's [built-in access control](https://etcd.io/docs/v3.4.0/op-guide/authentication/){: external}. 

While technically possible - turning off etcd authentication is **NOT** highly discouraged. {{site.data.keyword.databases-for-etcd}} automatically fixes any deployments where etcd authentication has been deliberately turned off.
{: .important}

## The admin user
{: #user-management-admin-user}

When you provision a {{site.data.keyword.databases-for-etcd}} deployment, an `admin` user is automatically created. 

Set the admin password before using it to connect.
{: important}

### Setting the Admin Password in the UI
{: #user-management-set-admin-password-ui}
{: ui}

To set the password through the {{site.data.keyword.cloud_notm}} dashboard, select __Manage** from the service dashboard. Open the _Settings_ tab, and use _Change Database Admin Password_ to set a new admin password.

### Setting the Admin Password in the CLI
{: #user-management-set-admin-password-cli}
{: cli}

Use the `cdb user-password` command from the {{site.data.keyword.cloud_notm}} CLI {{site.data.keyword.databases-for}} plug-in to set the admin password.

For example, to set the admin password for a deployment named `example-deployment`, use the following command:

```sh
ibmcloud cdb user-password example-deployment admin <newpassword>
```
{: pre}

### Setting the Admin Password in the API
{: #user-management-set-admin-password-api}
{: api}

The Foundation Endpoint that is shown on the Overview panel Deployment Details section of your service provides the base URL to access this deployment through the API. Use it with the [Set specified user's password](https://cloud.ibm.com/apidocs/cloud-databases-api/cloud-databases-api-v5#changeuserpassword){: external} endpoint to set the admin password.

```sh
curl -X PATCH `https://api.{region}.databases.cloud.ibm.com/v5/ibm/deployments/{id}/users/admin` \
-H `Authorization: Bearer <>` \
-H `Content-Type: application/json` \ 
-d `{"password":"newrootpasswordsupersecure21"}` \
```
{: pre}

## Managing Users and Roles through the UI
{: #user-management-ui}
{: ui}

1. Go to the service dashboard for your service.
2. Click _Service Credentials_ to open the _Service Credentials_ section.
3. Click __New Credential**.
4. Choose a descriptive name for your new credential. 
5. (Optional) Specify whether the new credentials use a public or private endpoint. Use either `{ "service-endpoints": "public" }` / `{ "service-endpoints": "private" }` in the _Add Inline Configuration Parameters_ field to generate connection strings that use the specified endpoint. Use of the endpoint is not enforced. It just controls which hostnames are in the connection strings. Public endpoints are generated by default.
6. Click _Add_ to provision the new credentials. A username and password, and an associated etcd user is auto-generated.

The new credentials appear in the table, and the connection strings are available as JSON in a click-to-copy field under _View Credentials_.

Creating a user from the CLI or API doesn't automatically populate that user's connection strings into _Service Credentials_. If you want to add them there, you can create a new credential with the existing user information. Enter the username and password in the JSON field under _Add Inline Configuration Parameters_. For example, {"existing_credentials":{"username":"Robert","password":"supersecure"}}. Basically, you send in the username and password, and _Service Credentials_ generates the connection strings with the credentials filled in.

Generating credentials from an existing user does not check for or create that user. 
{: .tip}

Users that you [create through _Service Credentials_](/docs/databases-for-etcd?topic=databases-for-etcd-connection-strings) are given the roles [`readWriteAnyDatabase`](https://docs.etcd.com/manual/reference/built-in-roles/#readWrite){: external} and [`dbAdminAnyDatabase`](https://docs.etcd.com/manual/reference/built-in-roles/#dbAdmin){: external}.

If you need users that are created from _Service Credentials_ to have a different role, you can use the admin user to change their role.

## Managing Users and Roles through the CLI
{: #user-management-cli}
{: cli}

If you need users to have a different role, you can use the `admin` user to change their role.

Users that are created directly from the CLI do not appear in _Service Credentials_, but you can add them.

If you manage your service through the [{{site.data.keyword.databases-for}} CLI plug-in](/docs/cli?topic=cli-install-ibmcloud-cli), create a new user with `cdb user-create`. For example, to create a new user for an "example-deployment", use the following command:

```sh
ibmcloud cdb user-create example-deployment <newusername> <newpassword>
```
{: pre}

When the task finishes, retrieve the new user's connection strings with the `ibmcloud cdb deployment-connections` command.

etcd centralizes user data in the `admin` database. List all users and their roles and database permissions [in the mongo shell](/docs/databases-for-etcd?topic=databases-for-etcd-mongo-shell) by using the `show users` command.

```sh
ibmcloud cdb deployment-connections --start -u admin etcd-production
Database Password>>
etcd shell version v4.0.3
connecting to: etcd://....
....
replset:PRIMARY> use admin
switched to db admin
replset:PRIMARY> show users
```
{: pre}

Users that are created in the CLI get the same role as _Service Credential_ users, `rwall`. They have access read and write access to all the keys in the database. If you need them to have a different role that you have created, you can use the `root` user to change their role.

Users that are created directly from the CLI do not appear in _Service Credentials_, but you can add them if you choose.

## Managing Users and Roles through the API
{: #user-management-api}
{: api}

If you need users to have a different role, use the admin user to change their role.

Users that are created directly from the API do not appear in _Service Credentials_, but you can add them.

The _Foundation Endpoint_ that is shown on the _Overview_ section of your service provides the base URL to access this deployment through the API. To create and manage users, use the base URL with the [`/users` endpoint](https://cloud.ibm.com/apidocs/cloud-databases-api#creates-a-database-level-user).

The command looks like: 

```sh
curl -X POST 'https://api.{region}.databases.cloud.ibm.com/v4/ibm/deployments/{id}/users' \
-H "Authorization: Bearer $APIKEY" \
-H "Content-Type: application/json" \
-d '{"username":"jane_smith", "password":"newsupersecurepassword"}'
```
{: pre}

To retrieve a user's connection strings, use the base URL with the `/users/{userid}/connections` endpoint.

Users that are created in the API get the same role as _Service Credential_ users, `rwall`. They have access read and write access to all the keys in the database. If you need them to have a different role that you have created, you can use the `root` user to change their role.

Users that are created directly from the API do not appear in _Service Credentials_, but you can add them if you choose.

## The root user
{: #user-management-root-user}

When you provision a new deployment in {{site.data.keyword.cloud_notm}}, you are automatically given access to the etcd `root` user. You can also add users in the _Service Credentials_ panel, which allows for access to etcd to be integrated with your {{site.data.keyword.cloud_notm}} account and [IAM](/docs/databases-for-etcd?topic=cloud-databases-iam).

The [etcd root user](https://etcd.io/docs/v3.4.0/op-guide/authentication/#special-users-and-roles) is intended for use as an administrative user. It is granted the root role, which gives read/write access to the entire key space, cluster operations, and privileges to create, modify, and delete other roles and users on your deployment.

## etcd roles
{: #user-management-etcd-roles}

etcd uses a system of roles to manage database and key access. Roles are used to give users a set of privileges. If you connect to your deployment using the root user and [`ectdctl`](/docs/databases-for-etcd?topic=databases-for-etcd-connecting-etcdctl), you can check the roles on your deployment with a command like:

```sh
ETCDCTL_API=3 etcdctl --cacert=c5f07736-d94c-11e8-a2e9-62ec2ed68f84 --endpoints=https://35dae549-2275-4d3e-baed-d86f36022336.974550db65eb4ec0983f023940bf637f.databases.appdomain.cloud:32460 --user=root:$PASSWORD role list
```
{: pre}

Create roles that grant read access, write access, or both to specific keys or ranges of keys. Refer to the etcd documentation for [commands to manage roles](https://etcd.io/docs/v3.4.0/op-guide/authentication/#working-with-roles).

Once you have created a role, assign it to a user. List the users on your deployment with a command like:
```sh
ETCDCTL_API=3 etcdctl --cacert=c5f07736-d94c-11e8-a2e9-62ec2ed68f84 --endpoints=https://35dae549-2275-4d3e-baed-d86f36022336.974550db65eb4ec0983f023940bf637f.databases.appdomain.cloud:32460 --user=root:$PASSWORD user list
```
{: pre}

## _Service Credential_ Users
{: #user-management-service-cred-users}

Users that you create through the _Service Credentials_ panel are given the role `rwall`. They have access read and write access to all the keys in the database.

If you need users that are created from _Service Credentials_ to have a different role, you can use the root user to change their role.

## Users created in etcd
{: #user-management-etcd-users}

Bypass creating users in _Service Credentials_, the CLI, the API, and [create users directly in etcd](https://etcd.io/docs/v3.4.0/op-guide/authentication/#working-with-users). 

Users who are created directly in etcd do not appear in _Service Credentials_, but you can [add them](/docs/databases-for-etcd?topic=databases-for-etcd-connection-strings#adding-users-to-_service-credentials_){: external}.

## The compose user
{: #user-management-compose-user}

If you use `etcdctl` to list the users on your deployment, you might have noticed a user that is named `compose`. The `compose` user is the internal administrative account that manages replication, cluster operations, and other functions that ensure the stability of your deployment. It has the same roles and privileges as the `root` user. Changing or deleting to the `compose` user is not advised and will disrupt the stability of your deployment.
